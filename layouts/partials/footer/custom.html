<!-- 背景音乐播放器 -->
<!-- 1. 音频元素 -->
<audio id="background-music" src="/audio/wow-Capital of the Orcs.opus" preload="metadata" loop></audio>

<!-- 2. 播放器容器 -->
<div id="music-player-container">
    <!-- 播放/暂停按钮 -->
    <button id="music-toggle-btn" aria-label="Play/Pause Music">
        <i class="fas fa-play"></i>
    </button>
    <!-- 音乐信息 -->
    <div id="music-info">
        <div id="music-filename">Loading...</div>
        <div id="music-time">
            <span id="music-current-time">0:00</span> / <span id="music-total-time">0:00</span>
        </div>
    </div>
</div>

<!-- 3. JavaScript 控制逻辑 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 获取所有需要的 DOM 元素
        const audio = document.getElementById('background-music');
        const playerContainer = document.getElementById('music-player-container');
        const toggleBtn = document.getElementById('music-toggle-btn');
        const icon = toggleBtn.querySelector('i');
        const filenameEl = document.getElementById('music-filename');
        const currentTimeEl = document.getElementById('music-current-time');
        const totalTimeEl = document.getElementById('music-total-time');

        // 默认音量
        audio.volume = 0.7;

        // --- 核心功能函数 ---

        // 格式化时间 (秒 -> 00:00)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // 播放/暂停逻辑
        function togglePlay() {
            if (audio.paused) {
                audio.play().catch(error => console.error("Audio play failed:", error));
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
            } else {
                audio.pause();
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
            }
        }
        
        // --- 事件监听 ---

        // 1. 按钮点击事件
        toggleBtn.addEventListener('click', togglePlay);

        // 2. 音频元数据加载完毕后，更新总时长和文件名
        audio.addEventListener('loadedmetadata', () => {
            totalTimeEl.textContent = formatTime(audio.duration);
            // 从 src 中提取文件名
            const srcParts = audio.src.split('/');
            filenameEl.textContent = decodeURIComponent(srcParts[srcParts.length - 1]);
        });

        // 3. 播放时间更新时，更新当前时间显示
        audio.addEventListener('timeupdate', () => {
            currentTimeEl.textContent = formatTime(audio.currentTime);
        });

    });
</script>